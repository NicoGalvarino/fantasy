<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fantasy_agn.models &mdash; Fantasy 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/fantasy.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Tutorial.html">FANTASY Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Documentation.html">Fantasy package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Fantasy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>fantasy_agn.models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for fantasy_agn.models</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">BlackBody</span>
<span class="kn">from</span> <span class="nn">sherpa.models</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">sherpa.models.parameter</span> <span class="kn">import</span> <span class="n">Parameter</span><span class="p">,</span> <span class="n">tinyval</span>
<span class="kn">from</span> <span class="nn">sherpa.utils</span> <span class="kn">import</span> <span class="n">SherpaFloat</span><span class="p">,</span> <span class="n">sao_fcmp</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;create_input_folder&quot;</span><span class="p">,</span>
    <span class="s2">&quot;automatic_path&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_line&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_tied_model&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_model&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_fixed_model&quot;</span><span class="p">,</span>
    <span class="s2">&quot;create_feii_model&quot;</span>
    <span class="p">)</span>
<span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="n">input_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="create_input_folder"><a class="viewcode-back" href="../../fantasy_agn.html#fantasy_agn.models.create_input_folder">[docs]</a><span class="k">def</span> <span class="nf">create_input_folder</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span> <span class="n">path_to_folder</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_input_folder function creates a folder in the specified path.</span>
<span class="sd">    The function takes three arguments:</span>
<span class="sd">        1) xmin - the minimum value of the range to be used for creating input files, default is 4000</span>
<span class="sd">        2) xmax - the maximum value of the range to be used for creating input files, default is 7000</span>
<span class="sd">        3) path_to_folder - The path where you want your new folder created. Default is current directory</span>
<span class="sd">    </span>
<span class="sd">    :param xmin=4000: Used to Set the minimum value of the x-axis (position or wavelength).</span>
<span class="sd">    :param xmax=7000: Used to Limit the maximum value of the x-axis.</span>
<span class="sd">    :param path_to_folder=&#39;&#39;: Used to Specify the path to the folder where you want to save your file.</span>
<span class="sd">    :param overwrite=True: Used to Overwrite the files in the input folder.</span>
<span class="sd">    :return: The path to the folder where the input files are stored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_to_folder</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory &quot;</span><span class="p">,</span> <span class="n">path_to_folder</span><span class="p">,</span> <span class="s2">&quot; Created &quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory &quot;</span><span class="p">,</span> <span class="n">path_to_folder</span><span class="p">,</span> <span class="s2">&quot; already exists&quot;</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">path1</span>
    <span class="n">path1</span> <span class="o">=</span> <span class="n">path_to_folder</span>
    <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">input_path</span> <span class="o">+</span> <span class="s2">&quot;/*.csv&quot;</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">position</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">wav</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">wav</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">]</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">path_to_folder</span>  <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="automatic_path"><a class="viewcode-back" href="../../fantasy_agn.html#fantasy_agn.models.automatic_path">[docs]</a><span class="k">def</span> <span class="nf">automatic_path</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">path_to_models</span><span class="o">=</span><span class="n">input_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The automatic_path function takes a spectrum object and creates a directory with the name of the spectrum.</span>
<span class="sd">    It then saves all models within the input path that fall within the wavelength range of your data to this directory.</span>
<span class="sd">    </span>
<span class="sd">    :param s: Used to Define the spectrum object.</span>
<span class="sd">    :param path_to_models=input_path: Used to Specify the path to the models.</span>
<span class="sd">    :param overwrite=True: Used to Overwrite a model if it already exists.</span>
<span class="sd">    :return: The path to the directory where the.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dirName</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">wave</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dirName</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory &quot;</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="s2">&quot; Created &quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory &quot;</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="s2">&quot; already exists&quot;</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">path1</span>
    <span class="n">path1</span> <span class="o">=</span> <span class="n">dirName</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">,</span> <span class="n">path1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path_to_models</span> <span class="o">+</span> <span class="s2">&quot;/*.csv&quot;</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">position</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">wav</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">wav</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">]</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">dirName</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
<span class="k">def</span> <span class="nf">continuum</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;brokenpowerlaw&#39;</span><span class="p">,</span> <span class="n">refer</span><span class="o">=</span><span class="mi">5500</span><span class="p">,</span> <span class="n">min_refer</span><span class="o">=</span><span class="mi">5400</span><span class="p">,</span> <span class="n">max_refer</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span> <span class="n">index1</span><span class="o">=-</span><span class="mf">1.7</span><span class="p">,</span> <span class="n">min_index1</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_index1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_index2</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_index2</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The continuum function is a broken power law.</span>
<span class="sd">    </span>
<span class="sd">    The function is defined as:</span>
<span class="sd">    </span>
<span class="sd">        f(x) = ampl * (x / refer)^index1 for x &gt; refer</span>
<span class="sd">             = ampl * (refer / refer)^(index1+index2) for x &lt; refer</span>
<span class="sd">    </span>
<span class="sd">        where the amplitude, index, and reference wavelength are parameters of the model.  The default values are:</span>
<span class="sd">    </span>
<span class="sd">            ampl     1e-16 erg/cm**2/s/Angstrom</span>
<span class="sd">            index    -0.7   dimensionless constant that defines the slope of the power law above 5000 Angstroms; it is equal to -0.7 in our fit to UVES spectra from Vestergaard &amp; Peterson 1991 ApJ 374, 344; this value was changed from -0.5 to account for higher resolution data from Keck Observatories since that paper was published (see Section 2 of Smith et al 2006 ApJS 164, 508).  This parameter can be set between 0 and 3 inclusive with a limit placed on its value by requiring that it must be greater than or equal to min_index when evaluated at max_refer and less than or equal to max_index when evaluated at min_refer; see below for more details on these parameters which control</span>
<span class="sd">    </span>
<span class="sd">    :param spec: Used to Pass in the spectrum to fit.</span>
<span class="sd">    :param name=&#39;brokenpowerlaw&#39;: Used to Name the model in a fit.</span>
<span class="sd">    :param refer=5500: Used to Set the wavelength of the continuum.</span>
<span class="sd">    :param min_refer=5400: Used to Set the minimum wavelength of the continuum.</span>
<span class="sd">    :param max_refer=5600: Used to Limit the range of wavelengths to which the continuum is calculated.</span>
<span class="sd">    :param index1=-1.7: Used to Fit the continuum.</span>
<span class="sd">    :param min_index1=-3: Used to Set the minimum value of the index.</span>
<span class="sd">    :param max_index1=0: Used to Fix the index of the power law at zero.</span>
<span class="sd">    :param index2=0: Used to Make the continuum flat.</span>
<span class="sd">    :param min_index2=-1: Used to Set the minimum value of the index2 parameter.</span>
<span class="sd">    :param max_index2=1: Used to Fix the index of the continuum at 1.</span>
<span class="sd">    :return: The continuum of the spectrum given as arguments.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">wave</span><span class="o">&gt;</span><span class="n">min_refer</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">wave</span><span class="o">&lt;</span><span class="n">max_refer</span><span class="p">)</span>
    <span class="n">ampl</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    

    <span class="k">class</span> <span class="nc">BrokenPowerlaw</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;brokenpowerlaw&quot;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">refer</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;refer&quot;</span><span class="p">,</span>
                <span class="n">refer</span><span class="p">,</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">min_refer</span><span class="p">,</span>
                <span class="nb">max</span><span class="o">=</span><span class="n">max_refer</span><span class="p">,</span>
                <span class="n">hard_min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span>
                <span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ampl&quot;</span><span class="p">,</span> <span class="n">ampl</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.05</span> <span class="o">*</span> <span class="n">ampl</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.95</span><span class="o">*</span><span class="n">ampl</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">index1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;index1&quot;</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_index1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_index1</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">index2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;index2&quot;</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_index2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_index2</span><span class="p">)</span>

            <span class="n">model</span><span class="o">.</span><span class="n">ArithmeticModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index2</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># @modelCacher1d</span>
        <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xhi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

            <span class="k">if</span> <span class="mf">0.0</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;model evaluation failed, &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> refer cannot be zero&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SherpaFloat</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span>
                    <span class="n">arg</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">arg</span>
    <span class="k">return</span> <span class="n">BrokenPowerlaw</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_feii</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The _feii function is a function that takes in the parameter vector, pars,</span>
<span class="sd">    and x-values. It then calculates the model fluxes for each FeII line and </span>
<span class="sd">    combines them into one array. The parameters are:</span>
<span class="sd">    </span>
<span class="sd">        - pars[0] = offset velocity (km/s)</span>
<span class="sd">        - pars[len(uniq)] = offset velocity (km/s)</span>
<span class="sd">        - fwhm = full width half max of lines (km/s)</span>
<span class="sd">    </span>
<span class="sd">            where len(uniq) is the number of unique FeII lines in our data set.</span>
<span class="sd">    </span>
<span class="sd">    :param pars: Used to Pass the parameters of the function.</span>
<span class="sd">    :param x: Used to Define the wavelength range.</span>
<span class="sd">    :return: The f value for each of the unique values in the feii_model.</span>
<span class="sd">    </span>
<span class="sd">    :doc-author: Trelent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span>

    <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="s2">&quot;feII_model.csv&quot;</span><span class="p">)</span>

    <span class="n">uniq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">ime</span><span class="p">)</span>
    <span class="n">offs_kms</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)]</span>
    <span class="n">fwhm</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">f2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># starting index in pars</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">dft</span><span class="p">[</span><span class="n">dft</span><span class="p">[</span><span class="s2">&quot;ime&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">uniq</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="n">rxc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">Int</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Int</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="n">par</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rxc</span><span class="p">)):</span>

            <span class="n">shift</span> <span class="o">=</span> <span class="n">rxc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">offs_kms</span> <span class="o">/</span> <span class="n">c</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">rxc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mf">2.354</span><span class="p">)</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">rxc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Int</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">par</span> <span class="o">*</span> <span class="n">f</span>
            <span class="n">f2</span> <span class="o">+=</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">f2</span>


<span class="k">class</span> <span class="nc">FeII</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;feii&quot;</span><span class="p">):</span>
        <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="s2">&quot;feII_model.csv&quot;</span><span class="p">)</span>

        <span class="n">uniq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">ime</span><span class="p">)</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)):</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;amp_&quot;</span> <span class="o">+</span> <span class="n">uniq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                          <span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offs_kms&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">1000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span>
        <span class="p">)</span>

        <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">)</span>
        <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_feii</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_uv_feii</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span>

    <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="s2">&quot;uvfe.csv&quot;</span><span class="p">)</span>

    <span class="n">uniq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">ime</span><span class="p">)</span>
    <span class="n">offs_kms</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)]</span>
    <span class="n">fwhm</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">f2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># starting index in pars</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">dft</span><span class="p">[</span><span class="n">dft</span><span class="p">[</span><span class="s2">&quot;ime&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">uniq</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="n">rxc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="n">Int</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">Int</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="n">par</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rxc</span><span class="p">)):</span>

            <span class="n">shift</span> <span class="o">=</span> <span class="n">rxc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">offs_kms</span> <span class="o">/</span> <span class="n">c</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">rxc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mf">2.354</span><span class="p">)</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">rxc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">shift</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Int</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">f1</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">par</span> <span class="o">*</span> <span class="n">f</span>
            <span class="n">f2</span> <span class="o">+=</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">f2</span>


<span class="k">class</span> <span class="nc">UV_FeII</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;uv_feii&quot;</span><span class="p">):</span>
        <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="s2">&quot;uvfe.csv&quot;</span><span class="p">)</span>

        <span class="n">uniq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dft</span><span class="o">.</span><span class="n">ime</span><span class="p">)</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)):</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;amp_&quot;</span> <span class="o">+</span> <span class="n">uniq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                          <span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offs_kms&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">1000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span>
        <span class="p">)</span>

        <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">)</span>
        <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_uv_feii</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>



<div class="viewcode-block" id="create_line"><a class="viewcode-back" href="../../fantasy_agn.html#fantasy_agn.models.create_line">[docs]</a><span class="k">def</span> <span class="nf">create_line</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">4861</span><span class="p">,</span> <span class="n">ampl</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_ampl</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_ampl</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">min_fwhm</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_fwhm</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_offset</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="n">max_offset</span><span class="o">=</span><span class="mi">3000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_line function creates a line with the specified parameters.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        name (str): The name of the emission line.</span>
<span class="sd">    </span>
<span class="sd">        pos (float): The central wavelength of the emission line in Angstroms.</span>
<span class="sd">    </span>
<span class="sd">        ampl (float): The amplitude of the emission line in units of flux density at </span>
<span class="sd">            position x=0, i.e., F(x=0) = ampl * continuum_level + offset .  Note that this is not an absolute value but depends on how you normalize your spectrum!  </span>
<span class="sd">            Default is 5, which means that if your spectrum has a continuum level equal to 1 then F(x=0)=5 and if it&#39;s 0 then F(x=0)=5+offset .  </span>
<span class="sd">            If you want to set an absolute flux density rather than relative values, use hard_min and hard_max instead!</span>
<span class="sd">    </span>
<span class="sd">        min_ampl (float): A lower limit for amplitude above which no lines will be created by create_line().  This can be useful when creating multiple lines from one input parameter because sometimes there are &quot;bumps&quot; or other features in a single spectrum where it makes sense to have multiple lines with different centroids but similar amplitudes so they don&#39;t overlap each other</span>
<span class="sd">    </span>
<span class="sd">    :param name=&#39;line&#39;: Used to Name the line in the model.</span>
<span class="sd">    :param pos=4861: Used to Specify the central wavelength of the line.</span>
<span class="sd">    :param ampl=5: Used to Set the amplitude of the emission line.</span>
<span class="sd">    :param min_ampl=0: Used to Set the lower limit of the amplitude parameter.</span>
<span class="sd">    :param max_ampl=500: Used to Set the maximum value that ampl can take.</span>
<span class="sd">    :param fwhm=1000: Used to Set the width of the line.</span>
<span class="sd">    :param min_fwhm=5: Used to Set the minimum value of the fwhm.</span>
<span class="sd">    :param max_fwhm=10000: Used to Set a hard limit on the fwhm.</span>
<span class="sd">    :param offset=0: Used to Shift the line center to a different position.</span>
<span class="sd">    :param min_offset=-3000: Used to Set the minimum value of the offset.</span>
<span class="sd">    :param max_offset=3000: Used to Set the maximum offset of the line.</span>
<span class="sd">    :return: An instance of the emission_line class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">line</span><span class="o">=</span><span class="n">Emission_Line</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">line</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span><span class="n">pos</span>
    
    <span class="n">line</span><span class="o">.</span><span class="n">ampl</span><span class="o">=</span><span class="n">ampl</span>
    <span class="n">line</span><span class="o">.</span><span class="n">ampl</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_ampl</span>
    <span class="n">line</span><span class="o">.</span><span class="n">ampl</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_ampl</span>
    <span class="n">line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span>
    <span class="n">line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_fwhm</span>
    <span class="n">line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_fwhm</span>
    <span class="n">line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">=</span><span class="n">offset</span>
    <span class="n">line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_offset</span>
    <span class="n">line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_offset</span>
    
    <span class="k">return</span> <span class="n">line</span></div>
    
<span class="k">class</span> <span class="nc">Emission_Line</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ampl&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="mi">4861</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offs_kms&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>


        <span class="p">(</span><span class="n">ampl</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">offs_kms</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span> <span class="o">=</span> <span class="n">pars</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="n">offs_kms</span> <span class="o">/</span> <span class="n">c</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mf">2.354</span><span class="p">)</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">ampl</span>  <span class="c1"># /(sigma*np.sqrt(2*np.pi))</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="c1"># fwhm = sigma * 2.355</span>
        <span class="c1"># flux = ampl * (sigma*np.sqrt(2*np.pi))</span>

        <span class="k">return</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">Absorption_Line</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ampl&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="mi">4861</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offs_kms&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>


        <span class="p">(</span><span class="n">ampl</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">offs_kms</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span> <span class="o">=</span> <span class="n">pars</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="n">offs_kms</span> <span class="o">/</span> <span class="n">c</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mf">2.354</span><span class="p">)</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">ampl</span>  <span class="c1"># /(sigma*np.sqrt(2*np.pi))</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="c1"># fwhm = sigma * 2.355</span>
        <span class="c1"># flux = ampl * (sigma*np.sqrt(2*np.pi))</span>

        <span class="k">return</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_lorentz</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="p">(</span><span class="n">ampl</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">offs_kms</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span> <span class="o">=</span> <span class="n">pars</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="n">offs_kms</span> <span class="o">/</span> <span class="n">c</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">ampl</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="k">class</span> <span class="nc">Lorentz</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lorentz&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ampl&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="mi">4861</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offs_kms&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>
        <span class="c1"># self.sigma = model.Parameter(name, &#39;sigma&#39;, 1, min = 0, hard_min = 0, max = 200, units = &#39;angstroms&#39;)</span>
        <span class="c1"># self.flux = model.Parameter(name, &#39;flux&#39;, 10,  min = 0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_lorentz</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_narrow_gaussian</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

    <span class="p">(</span><span class="n">ampl</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span> <span class="o">=</span> <span class="n">pars</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="mf">2.355</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">ampl</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Narrow_Line</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Narrow_Line&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ampl&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="mf">5008.240</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the model&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">_narrow_gaussian</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_host</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

    <span class="c1"># (a1, a2, a3, a4, a5) = pars</span>
    <span class="n">gal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;gal.npy&quot;</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gal</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">f</span> <span class="o">+=</span> <span class="n">pars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">gal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1"># normpars = []</span>
    <span class="c1"># print(&#39;ovo je norma&#39;, np.linalg.norm(f))</span>

    <span class="c1"># for i in range(len(pars)-1):</span>
    <span class="c1">#     pars[i]=pars[i]/np.linalg.norm(f)</span>
    <span class="c1">#     normpars.append(pars[i])</span>

    <span class="c1"># for i in range(gal.shape[0]):</span>
    <span class="c1">#     f += normpars[ i ] * gal[ i ]</span>
    <span class="c1"># #f=pars[-1]*f</span>

    <span class="k">return</span> <span class="n">f</span>
    <span class="c1"># return a1*gal[0]+a2*gal[1]+a3*gal[2]+a4*gal[3]+a5*gal[4]</span>


<span class="k">class</span> <span class="nc">Host</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Host&quot;</span><span class="p">):</span>
        <span class="n">gal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;gal.npy&quot;</span><span class="p">)</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gal</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;a</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_host</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">_balmer_conti</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fit the Balmer continuum from the model of Dietrich+02&quot;&quot;&quot;</span>
    <span class="n">lambda_BE</span> <span class="o">=</span> <span class="mf">3646.0</span>  <span class="c1"># A</span>
    <span class="n">bbflux</span> <span class="o">=</span> <span class="n">BlackBody</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">lambda_BE</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">bbflux</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">bb</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tau</span><span class="p">))</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">lambda_BE</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span>


<span class="k">class</span> <span class="nc">BalCon</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;BalCon&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kelvins&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_balmer_conti</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Polynomial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;polynomial&quot;</span><span class="p">):</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;c</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">ArithmeticModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="c1"># @modelCacher1d</span>
    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xhi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SherpaFloat</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">xtemp</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">xtemp</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">y</span>


<span class="c1"># This model computes continuum emission using a power-law.</span>
<span class="k">class</span> <span class="nc">Powerlaw</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Power-law model.</span>
<span class="sd">    It is for use when the independent axis is in Angstroms.</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    refer</span>
<span class="sd">        The reference point at which the amplitude is defined, with</span>
<span class="sd">        units of Angstroms.</span>
<span class="sd">    ampl</span>
<span class="sd">        The amplitude at the reference point.</span>
<span class="sd">    index</span>
<span class="sd">        The index for the power law.</span>
<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    BrokenPowerlaw, Polynomial</span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The functional form of the model for points is::</span>
<span class="sd">        f(x) = ampl * (x / refer)^index</span>
<span class="sd">    and for integrated data sets the low-edge of the grid is used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;powerlaw&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refer</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;refer&quot;</span><span class="p">,</span>
            <span class="mf">5600.0</span><span class="p">,</span>
            <span class="n">tinyval</span><span class="p">,</span>
            <span class="n">hard_min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span>
            <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ampl&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">tinyval</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="n">tinyval</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;angstroms&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">ArithmeticModel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

    <span class="c1"># @modelCacher1d</span>
    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">xhi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The calc function evaluates the model for given parameter values and data.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pars : list of numbers or a number or array-like object (list, tuple, array) </span>
<span class="sd">        </span>
<span class="sd">            The parameter value(s) to be evaluated. If pars is a single number then it is used as the amplitude value for all bins; if pars has more than one element then they are used as the values for each bin in order. </span>
<span class="sd">        </span>
<span class="sd">            .. note: If an array-like object is provided that does not match the size of x then an error will be raised by numpy when calc() is called. This can occur if you do something like p[0] = [2,3] instead of p[0][:] = [2,3].</span>
<span class="sd">        </span>
<span class="sd">            .. warning: The parameters must already have been set before calling this function - there isn&#39;t a mechanism to set them at evaluation time (i.e., you can&#39;t do p[0].val=[2.,3.]). You can use `set_par` to change parameter settings after defining them with `create_parameter`.  </span>
<span class="sd">        x : number or array-like object (list, tuple, NumPy ndarray), optional </span>
<span class="sd">        </span>
<span class="sd">            The independent variable where calc</span>
<span class="sd">        </span>
<span class="sd">        :param self: Used to Access the attributes and methods of the class in which the function is defined.</span>
<span class="sd">        :param p: Used to Calculate the model.</span>
<span class="sd">        :param x: Used to Evaluate the model.</span>
<span class="sd">        :param xhi=None: Used to Indicate that the calculation is to be done without.</span>
<span class="sd">        :param **kwargs: Used to Handle named parameters that are not defined in the model class.</span>
<span class="sd">        :return: The model evaluated at the values of x for a given set of parameters.</span>
<span class="sd">        </span>
<span class="sd">        :doc-author: Trelent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="mf">0.0</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;model evaluation failed, &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> refer cannot be zero&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SherpaFloat</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">arg</span>


<span class="k">def</span> <span class="nf">_gaus</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xc</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">w</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">g</span>


<span class="c1"># with open(&#39;/home/yukawa/fantasy/fantasy/uvfe/uv_temp.txt&#39;) as f:</span>
<span class="c1">#     uv=f.readlines()</span>
<span class="c1"># uv = [x.strip() for x in uv]</span>

<span class="c1"># def _uv_fe(pars,x):</span>
<span class="c1">#     F=0</span>
<span class="c1">#     index=0</span>
<span class="c1">#     f=0</span>
<span class="c1">#     shift=pars[6]</span>
<span class="c1">#     sigma=pars[7]</span>
<span class="c1">#     for files in uv:</span>
<span class="c1">#         wave, rat=np.genfromtxt(files, unpack=True)</span>
<span class="c1">#         for i in range(len(wave)):</span>
<span class="c1">#             f += rat[i] * _line((pars[index],wave[i],shift, sigma), x)</span>

<span class="c1">#         F +=f</span>
<span class="c1">#         #plt.plot(x,F)</span>
<span class="c1">#         index += 1</span>
<span class="c1">#     return np.asarray(F)</span>

<span class="c1"># class UV_FeII(model.RegriddableModel1D):</span>

<span class="c1">#     def __init__(self, name=&#39;uv_feii&#39;):</span>
<span class="c1">#         self.amp60 = model.Parameter(name, &#39;amp60&#39;, 1, min = 0, hard_min = 0, max = 100)</span>
<span class="c1">#         self.amp61 = model.Parameter(name, &#39;amp61&#39;, 1, min = 0, hard_min = 0, max = 100)</span>
<span class="c1">#         self.amp62 = model.Parameter(name, &#39;amp62&#39;, 1, min = 0, hard_min = 0, max = 100)</span>
<span class="c1">#         self.amp63 = model.Parameter(name, &#39;amp63&#39;, 1, min = 0, hard_min = 0, max = 100)</span>
<span class="c1">#         self.amp78 = model.Parameter(name, &#39;amp78&#39;, 1, min = 0, hard_min = 0, max = 100)</span>
<span class="c1">#         self.ampzw1 = model.Parameter(name, &#39;ampzw1&#39;, 1, min = 0, hard_min = 0, max = 100)</span>
<span class="c1">#         self.shift = model.Parameter(name, &#39;shift&#39;, 0, min=-3000, max=3000)</span>
<span class="c1">#         self.sigma = model.Parameter(name, &#39;sigma&#39;, 2000, min=500, hard_min=0, max = 7000)</span>

<span class="c1">#         model.RegriddableModel1D.__init__(self, name,</span>
<span class="c1">#                                           (self.amp60, self.amp61, self.amp62,</span>
<span class="c1">#                                            self.amp63, self.amp78, self.ampzw1, self.shift, self.sigma))</span>

<span class="c1">#     def calc(self, pars, x, *args, **kwargs):</span>
<span class="c1">#         &quot;&quot;&quot;Evaluate the model&quot;&quot;&quot;</span>
<span class="c1">#         return _uv_fe(pars, x)</span>

<span class="k">def</span> <span class="nf">_line</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    

    <span class="p">(</span><span class="n">ampl</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">offs_kms</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span> <span class="o">=</span> <span class="n">pars</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span> 
    <span class="n">offset</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">*</span> <span class="n">offs_kms</span> <span class="o">/</span> <span class="n">c</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mf">2.354</span><span class="p">)</span>
    
    <span class="n">f1</span> <span class="o">=</span> <span class="n">ampl</span><span class="c1">#/(sigma*np.sqrt(2*np.pi))</span>
    <span class="n">f2</span> <span class="o">=-</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
    <span class="c1">#fwhm = sigma * 2.355</span>
    <span class="c1">#flux = ampl * (sigma*np.sqrt(2*np.pi))</span>
    
    <span class="k">return</span> <span class="n">f1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_balmer</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">lambda_BE</span> <span class="o">=</span> <span class="mf">3646.0</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span><span class="o">+</span><span class="s1">&#39;balmer.csv&#39;</span><span class="p">)</span>
    <span class="n">wave</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">rat</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">int</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)):</span>
        <span class="n">f</span> <span class="o">+=</span> <span class="n">rat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">_line</span><span class="p">((</span><span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wave</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pars</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">lambda_BE</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">f</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">f</span>


<span class="k">class</span> <span class="nc">Bal_Lines</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Bal_lines&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampl</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;ampl&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># self.pos = model.Parameter(name, &#39;pos&#39;, 4861, min = 0,frozen = True, units = &#39;angstroms&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offs_kms&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>
        <span class="c1"># self.sigma = model.Parameter(name, &#39;sigma&#39;, 1, min = 0, hard_min = 0, max = 200, units = &#39;angstroms&#39;)</span>
        <span class="c1"># self.flux = model.Parameter(name, &#39;flux&#39;, 10,  min = 0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;km/s&quot;</span>
        <span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_balmer</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_ssp_host</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

    <span class="n">gal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;ica.npy&quot;</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gal</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">f</span> <span class="o">+=</span> <span class="n">pars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">gal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">f</span>
    <span class="c1"># return a1*gal[0]+a2*gal[1]+a3*gal[2]+a4*gal[3]+a5*gal[4]</span>


<span class="k">class</span> <span class="nc">SSP</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Host&quot;</span><span class="p">):</span>
        <span class="n">gal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;ica.npy&quot;</span><span class="p">)</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gal</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;a</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_ssp_host</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>


<span class="c1"># def Line(</span>
<span class="c1">#     name=&quot;line&quot;,</span>
<span class="c1">#     pos=4861,</span>
<span class="c1">#     amplitude=2,</span>
<span class="c1">#     fwhm=3000,</span>
<span class="c1">#     offset=0,</span>
<span class="c1">#     min_offset=-3000,</span>
<span class="c1">#     max_offset=3000,</span>
<span class="c1">#     min_amplitude=0,</span>
<span class="c1">#     max_amplitude=1000,</span>
<span class="c1">#     min_fwhm=0,</span>
<span class="c1">#     max_fwhm=7000</span>
<span class="c1"># ):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#         Function to define lines in the model.</span>

<span class="c1">#         Parameters:</span>
<span class="c1">#         ___________</span>
<span class="c1">#         name: Name of the line; should be string.</span>
<span class="c1">#         position: Air wavelength of the line; it is fixed.</span>
<span class="c1">#         amplitude: Amplitude of the line.</span>
<span class="c1">#         fwhm: Full widhth of the half maximum; given in Angstroms.</span>
<span class="c1">#         offset: Ofsset of the line from the starting position.</span>
<span class="c1">#         Additionally all the parameters constraints can be given here. Example:</span>
<span class="c1">#         min_offset=0</span>

<span class="c1">#         Returns: Gaussian  with given parameters.</span>


<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#     gaussian = Broad_Line(name)</span>
<span class="c1">#     gaussian.pos = pos</span>
<span class="c1">#     gaussian.ampl = amplitude</span>
<span class="c1">#     gaussian.fwhm = fwhm</span>
<span class="c1">#     gaussian.offs_kms = offset</span>
<span class="c1">#     gaussian.offs_kms.max = max_offset</span>
<span class="c1">#     gaussian.offs_kms.min = min_offset</span>
<span class="c1">#     gaussian.ampl.min = min_amplitude</span>
<span class="c1">#     gaussian.ampl.max = max_amplitude</span>
<span class="c1">#     gaussian.fwhm.min = min_fwhm</span>
<span class="c1">#     gaussian.fwhm.max = max_fwhm</span>

<span class="c1">#     return gaussian</span>


<div class="viewcode-block" id="create_model"><a class="viewcode-back" href="../../fantasy_agn.html#fantasy_agn.models.create_model">[docs]</a><span class="k">def</span> <span class="nf">create_model</span><span class="p">(</span>
    <span class="n">files</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">default_limits</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">fwhm</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">min_offset</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">max_offset</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">min_amplitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_amplitude</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
    <span class="n">min_fwhm</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_fwhm</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_broad_model function creates a model for the broad lines in the data.</span>
<span class="sd">    It takes as input:</span>
<span class="sd">        filename - The name of the file containing all of your line names and positions. </span>
<span class="sd">                This should be a csv file with columns named &#39;line&#39;, &#39;position&#39;. </span>
<span class="sd">                The first row should contain column headers.</span>

<span class="sd">        prefix - A string that will be added to each component name in your model, e.g., if you give it &quot;broad_&quot;, all components will have names like &quot;broad_[LINE NAME]&quot;.</span>

<span class="sd">        default_limits - If True, limits on amplitudes, fwhms, offsets are set automatically based on what is reasonable for this dataset (see below). If False, no limits are set except such that min(amplitude) &gt; 0 and max(amplitude) &lt; 100 (this is because some models may not have any amplitude parameters at all).</span>

<span class="sd">        amplitude - Initial value for amplitudes; see above documentation about how this value might change depending on whether default_limits=True or False.. Default = 2.0 .</span>

<span class="sd">        fwhm - Initial value for FWHMs; see above documentation about how this value might change depending on whether default_limits=</span>

<span class="sd">    :param filename=&#39;&#39;: Used to Specify the name of the file that contains all of the lines.</span>
<span class="sd">    :param prefix=&#39;&#39;: Used to Give each line a unique name.</span>
<span class="sd">    :param default_limits=True: Used to Set the limits of the parameters to a default value.</span>
<span class="sd">    :param amplitude=2: Used to Set the default amplitude of the lines to 2.</span>
<span class="sd">    :param fwhm=3000: Used to Set the default value for the fwhm of each line.</span>
<span class="sd">    :param offset=0: Used to Indicate that the offset is not fixed.</span>
<span class="sd">    :param min_offset=-3000: Used to Set the minimum value for the offset.</span>
<span class="sd">    :param max_offset=3000: Used to Set the upper limit of the offset parameter.</span>
<span class="sd">    :param min_amplitude=0: Used to Remove the baseline from the fit.</span>
<span class="sd">    :param max_amplitude=100: Used to Set the upper limit of the amplitude to 100.</span>
<span class="sd">    :param min_fwhm=100: Used to Remove the noise lines in the spectra.</span>
<span class="sd">    :param max_fwhm=7000: Used to Avoid the model to go out of the data range.</span>
<span class="sd">    :return: A model, which is a list of line objects.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="n">file</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of csv files should be given to create model&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">default_limits</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">)):</span>
            <span class="n">model</span> <span class="o">+=</span> <span class="n">create_line</span><span class="p">(</span>
                <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ampl</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
                <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
                <span class="n">min_offset</span><span class="o">=</span><span class="n">min_offset</span><span class="p">,</span>
                <span class="n">max_offset</span><span class="o">=</span><span class="n">max_offset</span><span class="p">,</span>
                <span class="n">min_ampl</span><span class="o">=</span><span class="n">min_amplitude</span><span class="p">,</span>
                <span class="n">max_ampl</span><span class="o">=</span><span class="n">max_amplitude</span><span class="p">,</span>
                <span class="n">min_fwhm</span><span class="o">=</span><span class="n">min_fwhm</span><span class="p">,</span>
                <span class="n">max_fwhm</span><span class="o">=</span><span class="n">max_fwhm</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">)):</span>
            <span class="n">model</span> <span class="o">+=</span> <span class="n">create_line</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">ampl</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">ampl</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">fwhm</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">fwhm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">max_offset</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">max_offset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">min_offset</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">min_offset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">min_ampl</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">min_amplitude</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">max_ampl</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">max_amplitude</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">min_fwhm</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">min_fwhm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">max_fwhm</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">max_fwhm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span></div>


<span class="k">def</span> <span class="nf">create_absorption_model</span><span class="p">(</span>
    <span class="n">files</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">amplitude</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">fwhm</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">min_offset</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">max_offset</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">min_amplitude</span><span class="o">=-</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">max_amplitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">min_fwhm</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">max_fwhm</span><span class="o">=</span><span class="mi">7000</span><span class="p">,</span>
<span class="p">):</span>

  

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="n">file</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of csv files should be given to create model&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">)):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">Absorption_Line</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),)</span>
            
        <span class="n">line</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">line</span><span class="o">.</span><span class="n">ampl</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_offset</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">max_offset</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">ampl</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_amplitude</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">ampl</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_amplitude</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_fwhm</span><span class="p">,</span>
        <span class="n">line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_fwhm</span><span class="p">,</span>
        <span class="n">model</span><span class="o">+=</span><span class="n">line</span>
    
    <span class="k">return</span> <span class="n">model</span>


<span class="n">OIII5007</span> <span class="o">=</span> <span class="n">create_line</span><span class="p">(</span>
    <span class="s2">&quot;OIII5007&quot;</span><span class="p">,</span>
    <span class="n">pos</span><span class="o">=</span><span class="mf">5006.803341</span><span class="p">,</span>
    <span class="n">fwhm</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">ampl</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">min_fwhm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_fwhm</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">min_offset</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">max_offset</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">OIII_NII</span><span class="p">(</span><span class="n">ref_line</span><span class="o">=</span><span class="n">OIII5007</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The narrow_basic function creates a narrow line profile for the OIII5007, NII6584, and NII6548 lines.</span>
<span class="sd">    It takes in the position of each line as well as its FWHM and amplitude. It also takes in an offset value which is </span>
<span class="sd">    the same for all three lines. The function returns a dictionary with each of these parameters.</span>

<span class="sd">    :return: A list of the lines that are created.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">OIII4958</span> <span class="o">=</span> <span class="n">create_line</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;OIII4958&quot;</span><span class="p">,</span>
        <span class="n">pos</span><span class="o">=</span><span class="mf">4958.896072</span><span class="p">,</span>
        <span class="n">fwhm</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span>
        <span class="n">ampl</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">ampl</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span>
        <span class="n">offset</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">NII6584</span> <span class="o">=</span> <span class="n">create_line</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;NII6584&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mf">6583.46</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span>
    <span class="p">)</span>
    <span class="n">NII6548</span> <span class="o">=</span> <span class="n">create_line</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s2">&quot;NIII6548&quot;</span><span class="p">,</span>
        <span class="n">pos</span><span class="o">=</span><span class="mf">6548.05</span><span class="p">,</span>
        <span class="n">fwhm</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span>
        <span class="n">offset</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">,</span>
        <span class="n">ampl</span><span class="o">=</span><span class="n">NII6584</span><span class="o">.</span><span class="n">ampl</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ref_line</span> <span class="o">+</span> <span class="n">OIII4958</span> <span class="o">+</span> <span class="n">NII6584</span> <span class="o">+</span> <span class="n">NII6548</span>


<div class="viewcode-block" id="create_tied_model"><a class="viewcode-back" href="../../fantasy_agn.html#fantasy_agn.models.create_tied_model">[docs]</a><span class="k">def</span> <span class="nf">create_tied_model</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;OIII5007&#39;</span><span class="p">,</span>
    <span class="n">files</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">fix_oiii_ratio</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="mf">5006.803341</span><span class="p">,</span>
    <span class="n">amplitude</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">fwhm</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">min_offset</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span>
    <span class="n">max_offset</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">min_amplitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_amplitude</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">min_fwhm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">max_fwhm</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">included</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_tied_model function creates a model that is tied to another parameter.</span>
<span class="sd">    It takes the following arguments:</span>
<span class="sd">        name - The name of the line (e.g., OIII5007)</span>
<span class="sd">        files - A list of csv files containing data for this line (optional)</span>
<span class="sd">        prefix - The prefix used in defining parameters in other functions (default = &quot;&quot;) </span>
<span class="sd">    </span>
<span class="sd">         If included == True and fix_oiii_ratio==True, then it creates an instance of </span>
<span class="sd">         the OIII_NII class with a reference emission line defined by ref_line.  </span>
<span class="sd">    </span>
<span class="sd">         If included == True and fix_oiii_ratio==False, then it creates an instance </span>
<span class="sd">         of EmissionLine with a reference emission line defined by ref_line.  </span>
<span class="sd">    </span>
<span class="sd">         If included == False and fix_oiii_ratio==True, then it creates an instance </span>
<span class="sd">         of OIII5007 only.</span>
<span class="sd">    </span>
<span class="sd">    :param name=&#39;OIII5007&#39;: Used to Name the emission line.</span>
<span class="sd">    :param files=[]: Used to Pass a list of csv files to the model.</span>
<span class="sd">    :param prefix=&quot;&quot;: Used to Give a name to the model.</span>
<span class="sd">    :param fix_oiii_ratio=True: Used to Fix the ratio of oiii5007 to nii6583.</span>
<span class="sd">    :param position=0: Used to Define the position of the reference line.</span>
<span class="sd">    :param amplitude=2: Used to Set the amplitude of the emission line to 2.</span>
<span class="sd">    :param fwhm=10: Used to Set the fwhm of the reference line.</span>
<span class="sd">    :param offset=0: Used to Indicate that the line should be fixed to 0.</span>
<span class="sd">    :param min_offset=-3000: Used to Set the minimum offset of the line.</span>
<span class="sd">    :param max_offset=1000: Used to Set the maximum offset of a line to 1000 km/s.</span>
<span class="sd">    :param min_amplitude=0: Used to Avoid the model to go below 0.</span>
<span class="sd">    :param max_amplitude=1000: Used to Set a maximum value for the amplitude of the emission line.</span>
<span class="sd">    :param min_fwhm=0: Used to Avoid the fwhm of lines to be set to 0.</span>
<span class="sd">    :param max_fwhm=10000: Used to Avoid errors when the fwhm is very high.</span>
<span class="sd">    :param included=False: Used to Create a model without the emission line of interest.</span>
<span class="sd">    :return: A model that is tied to the parameters of a reference line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">ref_line</span> <span class="o">=</span> <span class="n">Emission_Line</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="n">position</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">ampl</span><span class="o">=</span><span class="n">amplitude</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">ampl</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">min_amplitude</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">ampl</span><span class="o">.</span><span class="n">max</span><span class="o">=</span> <span class="n">max_amplitude</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_fwhm</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_fwhm</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">=</span><span class="n">offset</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_offset</span>
    <span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_offset</span>

    <span class="k">if</span> <span class="n">included</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">fix_oiii_ratio</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">OIII_NII</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">ref_line</span><span class="o">=</span><span class="n">ref_line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">included</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">fix_oiii_ratio</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">model</span><span class="o">=</span><span class="n">ref_line</span>
    <span class="k">if</span> <span class="n">included</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">fix_oiii_ratio</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">OIII_NII</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">ref_line</span><span class="o">=</span><span class="n">ref_line</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fix_oiii_ratio</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">included</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="n">file</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of csv files should be given to create model&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">+=</span> <span class="n">create_line</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span>
            <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">pos</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">fwhm</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="p">,</span>
            <span class="n">offset</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">,</span>
            <span class="n">ampl</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
            <span class="n">min_offset</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
            <span class="n">max_offset</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
            <span class="n">min_fwhm</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
            <span class="n">max_fwhm</span><span class="o">=</span><span class="n">ref_line</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span></div>


<div class="viewcode-block" id="create_fixed_model"><a class="viewcode-back" href="../../fantasy_agn.html#fantasy_agn.models.create_fixed_model">[docs]</a><span class="k">def</span> <span class="nf">create_fixed_model</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="p">[],</span> 
                       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>     
                       <span class="n">amplitude</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                       <span class="n">fwhm</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
                       <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                       <span class="n">min_offset</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span>
                       <span class="n">max_offset</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span>
                       <span class="n">min_amplitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                       <span class="n">max_amplitude</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                       <span class="n">min_fwhm</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                       <span class="n">max_fwhm</span><span class="o">=</span><span class="mi">7000</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_fixed_model function creates a model that is fixed fwhm for all lines.</span>
<span class="sd">    The function takes as an argument a list of csv files, which contain the information (name and position) of all lines included in the model.</span>
<span class="sd">    It also takes as arguments: name, amplitude, fwhm (km/s), offset (km/s) and min_offset and max_offset (km/s). </span>
<span class="sd">    </span>
<span class="sd">    :param files=[]: Used to Pass a list of csv files to the model.</span>
<span class="sd">    :param name=&#39;&#39;: Used to Give the model a name.</span>
<span class="sd">    :param amplitude=2: Used to Set the initial value of the amplitude parameter.</span>
<span class="sd">    :param fwhm=3000: Used to Set the fwhm of the gaussian profile.</span>
<span class="sd">    :param offset=0: Used to Shift the lines to the center of each pixel.</span>
<span class="sd">    :param min_offset=-3000: Used to Set the minimum value of the offset.</span>
<span class="sd">    :param max_offset=3000: Used to Set the maximum offset of the line from its rest position.</span>
<span class="sd">    :param min_amplitude=0: Used to Set the minimum value of the amplitude parameter.</span>
<span class="sd">    :param max_amplitude=600: Used to Limit the maximum amplitude of the lines.</span>
<span class="sd">    :param min_fwhm=100: Used to Set a lower limit to the fwhm parameter.</span>
<span class="sd">    :param max_fwhm=7000: Used to Set the maximum value of the fwhm parameter.</span>
<span class="sd">    :param : Used to Set the initial value of the amplitude parameter.</span>
<span class="sd">    :return: A fixed_lines class object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path1</span> <span class="o">+</span> <span class="n">file</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List of csv files should be given to create model&quot;</span><span class="p">)</span>
        
    <span class="k">class</span> <span class="nc">Fixed_Lines</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
            <span class="n">dft</span> <span class="o">=</span> <span class="n">df</span>
            <span class="n">dft</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dft</span><span class="o">.</span><span class="n">line</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">dft</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

            <span class="n">uniq</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">pars</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">)):</span>
                <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Parameter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;amp_&quot;</span> <span class="o">+</span> <span class="n">uniq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="n">amplitude</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_amplitude</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_amplitude</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;offs_kms&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_offset</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="n">min_offset</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_offset</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km/s&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;fwhm&quot;</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_fwhm</span><span class="p">,</span> <span class="n">hard_min</span><span class="o">=</span><span class="n">min_fwhm</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_fwhm</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;km/s&#39;</span>
            <span class="p">)</span>

            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offs_kms</span><span class="p">)</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwhm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dft</span><span class="o">=</span><span class="n">dft</span>

            <span class="n">model</span><span class="o">.</span><span class="n">RegriddableModel1D</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">fixed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">f</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">dft</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dft</span>
            <span class="n">fwhm</span><span class="o">=</span><span class="n">pars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">offs_kms</span><span class="o">=</span><span class="n">pars</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)):</span>
                
                
                <span class="n">c</span> <span class="o">=</span> <span class="mf">299792.458</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">offs_kms</span> <span class="o">/</span> <span class="n">c</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">*</span> <span class="n">fwhm</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="mf">2.354</span><span class="p">)</span>

                <span class="n">f1</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># /(sigma*np.sqrt(2*np.pi))</span>
                <span class="n">f2</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="c1"># fwhm = sigma * 2.355</span>
                <span class="c1"># flux = ampl * (sigma*np.sqrt(2*np.pi))</span>

                <span class="n">f</span><span class="o">+=</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Fixed_Lines</span><span class="p">()</span></div>

<div class="viewcode-block" id="create_feii_model"><a class="viewcode-back" href="../../fantasy_agn.html#fantasy_agn.models.create_feii_model">[docs]</a><span class="k">def</span> <span class="nf">create_feii_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;feii&#39;</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">min_fwhm</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">max_fwhm</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_offset</span><span class="o">=-</span><span class="mi">3000</span><span class="p">,</span> <span class="n">max_offset</span><span class="o">=</span><span class="mi">3000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The create_feii_model function creates a FeII model with the specified parameters.</span>
<span class="sd">    </span>
<span class="sd">    :param name=&#39;feii&#39;: Used to Name the component.</span>
<span class="sd">    :param fwhm=2000: Used to Set the fwhm of the feii emission line.</span>
<span class="sd">    :param min_fwhm=1000: Used to Set the minimum value of the fwhm parameter.</span>
<span class="sd">    :param max_fwhm=8000: Used to Set the upper limit of the fwhm range.</span>
<span class="sd">    :param offset=0: Used to Set the central wavelength of the feii emission line.</span>
<span class="sd">    :param min_offset=-3000: Used to Set the minimum value of the offset parameter.</span>
<span class="sd">    :param max_offset=3000: Used to Set the maximum offset velocity of the feii emission line.</span>
<span class="sd">    :return: A feii object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fe</span><span class="o">=</span><span class="n">FeII</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">fe</span><span class="o">.</span><span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span>
    <span class="n">fe</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_fwhm</span>
    <span class="n">fe</span><span class="o">.</span><span class="n">fwhm</span><span class="o">.</span><span class="n">min</span><span class="o">=</span><span class="n">min_fwhm</span>
    <span class="n">fe</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">=</span><span class="n">offset</span>
    <span class="n">fe</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">min</span><span class="o">=</span> <span class="n">min_offset</span>
    <span class="n">fe</span><span class="o">.</span><span class="n">offs_kms</span><span class="o">.</span><span class="n">max</span><span class="o">=</span><span class="n">max_offset</span>
    <span class="k">return</span> <span class="n">fe</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, N. Rakic, D. Ilic and L. C. Popovic.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>